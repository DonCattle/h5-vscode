<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon"
          href="https://coraladimg.oss-cn-hangzhou.aliyuncs.com/presetcontent/%E7%BD%91%E7%AB%99%E5%AE%A3%E4%BC%A0%E9%A1%B5/coralicon.png"
          type="image/png">
    <title>è§£é”èµ„æº</title>
    <!-- å¼•å…¥ Vue2 -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <style>
        /* é‡ç½®é»˜è®¤æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* è®¾ç½®æ ¹å…ƒç´ å­—ä½“å¤§å°ï¼Œç”¨äºremå•ä½çš„è®¡ç®—åŸºå‡† */
        html {
            font-size: 16px;
            font-size: calc(100vw / 24);
        }

        /* è®¾ç½®é¡µé¢åŸºç¡€æ ·å¼ */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #f5f5f5;
            max-width: 100vw;
            overflow-x: hidden;
            overscroll-behavior-y: contain;
        }

        /* å†…å®¹å®¹å™¨ï¼Œä½¿ç”¨ç›¸å¯¹å•ä½ */
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 0.8rem;
        }

        /* é¡¶éƒ¨SOSæç¤ºæ æ ·å¼ */
        .alert {
            background-color: #f3e5f5;
            padding: 0.5rem;
            border-radius: 0.5rem;
            margin-bottom: 0.8rem;
            color: #333;
            font-size: 0.8rem;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            max-width: 80%;
            margin-left: auto;
            margin-right: auto;
        }

        /* SOSå›¾æ ‡æ ·å¼ */
        .sos-icon {
            color: #ff4081;
            margin-right: 0.5rem;
            display: inline-flex;
        }

        /* è¿›åº¦æ˜¾ç¤ºåŒºåŸŸæ ·å¼ */
        .progress-section {
            background-color: #e1f5fe;
            padding: 0.8rem;
            border-radius: 0.5rem;
            margin-bottom: 0.8rem;
        }

        /* è¿›åº¦æ–‡æœ¬å±…ä¸­æ˜¾ç¤º */
        .progress-text {
            text-align: center;
            margin-bottom: 0.75rem;
            font-size: 0.9375rem;
            color: #2196f3;
        }

        /* å‰©ä½™ä»»åŠ¡æ•°é‡æ˜¾ç¤ºåŒºåŸŸ */
        .remaining-tasks {
            text-align: center;
            font-size: 0.875rem;
            color: #666;
        }

        /* å‰©ä½™ä»»åŠ¡æ•°é‡æ ·å¼ */
        .remaining-count {
            color: #ff4081;
            font-weight: 500;
            padding: 0 0.2rem;
        }

        /* ä»»åŠ¡åˆ—è¡¨æ ‡é¢˜åŒºåŸŸæ ·å¼ */
        .task-header {
            background-color: #e0f2f1;
            padding: 0.8rem;
            border-radius: 0.5rem;
            margin-bottom: 0.8rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* æ ‡é¢˜æ–‡æœ¬å’Œå›¾æ ‡çš„å®¹å™¨ */
        .task-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        /* å®Œæˆæ—¶é—´æç¤ºæ–‡æœ¬æ ·å¼ */
        .task-time {
            font-size: 0.875rem;
            color: #666;
        }

        /* ä»»åŠ¡åˆ—è¡¨å®¹å™¨æ ·å¼ */
        .task-list {
            background-color: #e0f2f1;
            padding: 0;
            border-radius: 0.5rem;
            margin-bottom: 0.8rem;
            overflow: hidden;
        }

        /* å•ä¸ªä»»åŠ¡é¡¹æ ·å¼ */
        .task-item {
            margin-bottom: 0;
            background-color: white;
            padding: 0.8rem;
            border-radius: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }

        /* ä»»åŠ¡é¡¹åŒ…è£…å™¨ï¼ŒåŒ…å«ä»»åŠ¡é¡¹å’Œè¯´æ˜æ–‡å­— */
        .task-wrapper {
            margin: 0;
            padding: 0.8rem;
            background-color: #e0f2f1;
        }

        .task-wrapper + .task-wrapper {
            padding-top: 0;
        }

        /* ä»»åŠ¡è¯´æ˜åŒºåŸŸæ ·å¼ */
        .task-instruction {
            background-color: #f5f5f5;
            padding: 0.6rem 0.8rem;
            margin-top: 1px;
            border-radius: 0 0 0.5rem 0.5rem;
            font-size: 0.75rem;
            color: #666;
            line-height: 1.4;
        }

        /* ä»»åŠ¡è¯´æ˜ä¸­çš„å¼ºè°ƒæ–‡å­—æ ·å¼ */
        .highlight {
            color: #ff4081;
            font-weight: 500;
        }

        /* ä»»åŠ¡ä¿¡æ¯åŒºåŸŸæ ·å¼ */
        .task-info {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        /* é”å›¾æ ‡æ ·å¼ */
        .lock-icon {
            font-size: 20px;
        }

        /* ä»»åŠ¡åç§°æ ·å¼ */
        .task-name {
            font-weight: bold;
            margin-bottom: 0.25rem;
            font-size: 0.9375rem;
        }

        /* ä»»åŠ¡çŠ¶æ€æ ‡ç­¾æ ·å¼ */
        .status {
            color: #ff4081;
            font-size: 0.75rem;
            margin-left: 0.5rem;
        }

        /* ä»»åŠ¡æè¿°æ–‡æœ¬æ ·å¼ */
        .task-desc {
            font-size: 0.75rem;
            color: #666;
        }

        /*
        å¼¹çª—æ ·å¼â†“
        */
        /* å¼¹çª—çš„åŸºç¡€æ ·å¼ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5); /* åŠé€æ˜èƒŒæ™¯ */
            display: none; /* é»˜è®¤éšè— */
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.show {
            display: flex; /* æ˜¾ç¤ºå¼¹çª— */
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            padding: 20px;
            width: 95%;  /* è®¾ç½®å®½åº¦ä¸ºå±å¹•çš„ 95% */
            height: 80%; /* è®¾ç½®é«˜åº¦ä¸ºå±å¹•çš„ 80% */

            max-height: 80%;  /* ä¿è¯æœ€å¤§é«˜åº¦ */
            max-width: 700px;  /* æœ€å¤§å®½åº¦é™åˆ¶ä¸º400pxï¼Œé¿å…è¿‡å¤§ */
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            overflow-y: auto; /* å†…å®¹æº¢å‡ºæ—¶å…è®¸æ»šåŠ¨ */
        }

        .modal-header {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .modal-body {
            font-size: 16px;
            margin-bottom: 10px;
            padding-bottom: 25px;
        }

        .modal-body img{
            width: 99%;
        }
        .modal-footer {
            text-align: center;
            color: #FFD700;

        }

        .modal-footer button {
            background-color: #f4c756;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            width: 60%;
        }
        /* ä½¿æ–‡æœ¬å·¦å¯¹é½ */
        .steps1 .step1 {
            text-align: left;
            font-size: 12px;
            line-height: 1.5;
        }

        /* è®¾ç½®é«˜äº®éƒ¨åˆ†ï¼ˆç»¿è‰²èƒŒæ™¯ï¼Œç™½è‰²å­—ä½“ï¼‰ */
        .highlight1 {
            background-color: #4CAF50; /* ç»¿è‰²èƒŒæ™¯ */
            color: white;  /* ç™½è‰²å­—ä½“ */
            padding: 0 5px;  /* ç»™æ–‡å­—åŠ ä¸€ç‚¹å†…è¾¹è· */
            border-radius: 3px;  /* å¯é€‰ï¼Œåœ†è§’ */
        }


        /* å“åº”å¼è®¾è®¡ï¼Œé€‚åº”æ›´å°çš„å±å¹• */
        @media screen and (max-width: 480px) {
            .modal-content {
                width: 95%; /* ç¡®ä¿åœ¨å°å±å¹•ä¸Šé€‚é… */
                height: 80%; /* ç¡®ä¿å¼¹çª—é«˜åº¦é€‚åº”å±å¹• */
                padding: 15px; /* è°ƒæ•´å†…è¾¹è· */
            }

            .modal-header {
                font-size: 14px;
            }

            .modal-body {
                font-size: 10px;
            }

            .modal-footer button {
                font-size: 14px;
            }
        }

        /*
         å¼¹çª—æ ·å¼â†‘
         */

        /* è§£é”æŒ‰é’®æ ·å¼ */
        .unlock-btn {
            background: linear-gradient(to right, #ff4081, #ff6b9c);
            color: white;
            border: none;
            padding: 0.5rem 1.25rem;
            border-radius: 1.25rem;
            cursor: pointer;
            font-size: 0.875rem;
            min-height: 2.5rem;
            min-width: 5.5rem;
            white-space: nowrap;
            flex-shrink: 0;
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            transform: scale(1);
            outline: none;
            box-shadow: 0 3px 6px rgba(255, 64, 129, 0.2);
            position: relative;
            overflow: hidden;
        }

        /* æŒ‰é’®ç‚¹å‡»æ•ˆæœ */
        .unlock-btn:active {
            background: linear-gradient(to right, #f80000, #ff0000);
            transform: scale(0.8);
            box-shadow: 0 2px 4px rgba(255, 140, 0, 0.3);
        }


        .unlock-btn:active::after {
            animation: ripple 0.4s ease-out;
        }

        @keyframes ripple {
            0% {
                transform: scale(0, 0) translate(-50%, -50%);
                opacity: 0.5;
            }

            100% {
                transform: scale(20, 20) translate(-50%, -50%);
                opacity: 0;
            }
        }

        /* å®ŒæˆçŠ¶æ€çš„æŒ‰é’®æ ·å¼ */
        .unlock-btn.completed {
            background: linear-gradient(to right, #FFD700, #FFA500);
            cursor: default;
            transform: scale(1);
            opacity: 1;
            box-shadow: 0 3px 6px rgba(255, 215, 0, 0.2);
        }

        /* ç¦ç”¨å·²å®ŒæˆæŒ‰é’®çš„ç‚¹å‡»æ•ˆæœ */
        .unlock-btn.completed:active {
            transform: scale(1);
            background: linear-gradient(to right, #FFD700, #FFA500);
            box-shadow: 0 3px 6px rgba(255, 215, 0, 0.2);
        }

        .unlock-btn.completed::after {
            display: none;
        }

        /* å®ŒæˆçŠ¶æ€çš„æ–‡å­—æ ·å¼ */
        .status.completed {
            color: #FFD700;
        }

        /* åº•éƒ¨æ•™ç¨‹é“¾æ¥å®¹å™¨æ ·å¼ */
        .footer {
            text-align: center;
            margin-top: 1.5rem;
            font-size: 0.875rem;
        }

        /* åº•éƒ¨é“¾æ¥æ ·å¼ */
        .footer a {
            color: #2196f3;
            text-decoration: none;
        }

        /* ä¸‹æ‹‰åˆ·æ–°æç¤ºæ ·å¼ */
        .pull-refresh-indicator {
            position: fixed;
            top: -40px;
            left: 0;
            right: 0;
            height: 40px;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: #666;
            transition: transform 0.2s;
            z-index: 1000;
        }

        .pull-refresh-indicator.visible {
            transform: translateY(40px);
        }

        /* åª’ä½“æŸ¥è¯¢ */
        @media screen and (min-width: 768px) {
            html {
                font-size: 16px;
            }

            .container {
                max-width: 600px;
                padding: 1rem;
            }
        }

        @media screen and (max-width: 320px) {
            html {
                font-size: calc(100vw / 26);
            }
        }

        @media screen and (orientation: landscape) and (max-height: 500px) {
            .container {
                padding: 0.5rem;
            }

            .task-item {
                padding: 0.6rem;
            }
        }

        /* å®‰å…¨åŒºåŸŸè¾¹è· */
        .container {
            padding-left: max(0.8rem, env(safe-area-inset-left));
            padding-right: max(0.8rem, env(safe-area-inset-right));
            padding-bottom: max(0.8rem, env(safe-area-inset-bottom));
        }

        /* æ·»åŠ æ–°æ ·å¼ */
        /* å®Œæˆæç¤ºå®¹å™¨æ ·å¼ */
        .completion-message {
            background: linear-gradient(to right, #f0f0f3, #eff0f0);
            color: rgb(10, 9, 9);
            padding: 1.5rem;
            border-radius: 0.5rem;
            text-align: center;
            font-size: 1rem;
            font-weight: 500;
            opacity: 0;
            position: fixed;
            top: 0;
            left: 50%;
            transform: translate(-50%, 0);
            width: 95%;
            max-width: 600px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            pointer-events: none;
            transition: all 0.5s ease;
            z-index: 1000;
            height: 100vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            /* ä¸ºiOSæ·»åŠ å¹³æ»‘æ»šåŠ¨ */
        }

        .completion-message.show {
            opacity: 1;
            transform: translate(-50%, 0);
            pointer-events: auto;
        }

        /* å®Œæˆæ¶ˆæ¯æ ‡é¢˜æ ·å¼ */
        .completion-message > div:first-child {
            position: sticky;
            top: 0;
            background: inherit;
            padding: 1rem 0;
            margin: -1.5rem -1.5rem 1rem -1.5rem;
            padding: 1.5rem;
            font-size: 1.2rem;
            font-weight: 600;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        /* ä»»åŠ¡åˆ—è¡¨æ·¡å‡ºåŠ¨ç”» */
        .task-container {
            opacity: 1;
            transform: translateY(0);
            transition: all 0.5s ease;
        }

        .task-container.hide {
            opacity: 0;
            transform: translateY(-20px);
            pointer-events: none;
        }

        /* APIè¿”å›å†…å®¹æ ·å¼ */
        .api-content {
            padding: 0 0.5rem;
            text-align: left;
            position: relative;
            z-index: 1001;
            pointer-events: auto;
        }

        .api-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #333;
            text-align: center;
        }

        .api-text {
            font-size: 0.9rem;
            line-height: 1.5;
            color: #666;
            margin-bottom: 1rem;
            word-break: break-word;
        }

        /* å¤åˆ¶æŒ‰é’®æ ·å¼ */
        .copy-button {
            background: linear-gradient(to right, #2ecc71, #27ae60);
            color: white;
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 0.4rem;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            margin: 1rem auto;
            display: block;
            position: relative;
            z-index: 1001;
            pointer-events: auto;
            box-shadow: 0 3px 6px rgba(46, 204, 113, 0.2);
            min-width: 120px;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        /* å¤åˆ¶æŒ‰é’®ç‚¹å‡»æ•ˆæœ */
        .copy-button:active {
            background: linear-gradient(to right, #fb7542, #ef997f);
            box-shadow: 0 2px 4px rgba(46, 204, 113, 0.1);
            transform: scale(0.8);
        }

        /* æ·»åŠ è§¦æ‘¸åé¦ˆ */
        @media (hover: none) {
            .copy-button {
                -webkit-tap-highlight-color: transparent;
            }

            .copy-button:active {
                background: linear-gradient(to right, #fb7542, #ef997f);
                box-shadow: 0 2px 4px rgba(46, 204, 113, 0.1);
                transform: scale(0.8);
            }
        }

        /* æ·»åŠ Toastæç¤ºæ ·å¼ */
        .toast-message {
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 0.8rem 1.2rem;
            border-radius: 0.4rem;
            font-size: 0.9rem;
            z-index: 2000;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            max-width: 80%;
            pointer-events: none;
        }

        /* åŠ è½½ä¸­çš„Toastæ ·å¼ */
        .toast-message.loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .toast-message.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        /* æ·»åŠ åŠ è½½åŠ¨ç”»æ ·å¼ */
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 0.8s linear infinite;
            vertical-align: middle;
        }

        /* ç¦ç”¨ä¸‹æ‹‰åˆ·æ–°æ—¶çš„æ ·å¼ */
        .pull-refresh-disabled {
            display: none !important;
        }
    </style>
</head>

<body>
<div id="app">
    <!-- ä¸‹æ‹‰åˆ·æ–°æç¤º -->
    <div class="pull-refresh-indicator" :class="{
                 visible: isRefreshVisible,
                 'pull-refresh-disabled': allTasksCompleted 
             }">
        <span>{{ refreshText }}</span>
    </div>
    <!-- å¼¹çª—ç»“æ„ -->
    <div class="modal" v-bind:class="{ show: showModal }">
        <div class="modal-content">
            <div class="modal-header">
                <span>è¿‡ç¨‹å¾ˆç®€å•ï¼Œå‡ ç§’å°±ä¼šäº†</span>
            </div>
            <div class="modal-body">
                <img src="https://coraladimg.oss-cn-hangzhou.aliyuncs.com/2024/11/25/38d7c801-7d10-43ac-b319-c5b14dc60559_1625288373070.jpg" alt="è§£é”å›¾æ ‡" class="unlock-image" />
                <div class="steps1">
                    <p class="step1">1. è¿›å…¥å°æ¸¸æˆï¼Œç‚¹å‡»å³ä¸Šè§’ <span class="highlight1">è§£é”ç›’å­</span></p>
                    <p class="step1">2. å¹¿å‘Šæ’­æ”¾å®Œæˆåç‚¹å‡»å¹¿å‘Šä¸‹æ–¹çš„ <span class="highlight1">ç»¿è‰²æŒ‰é’®</span>å¹¶ç­‰6ç§’</p>
                </div>
            </div>
            <div class="modal-footer">
                <button @click="closeModal">çŸ¥é“äº†ï¼Œé©¬ä¸Šå»</button>
            </div>
        </div>
    </div>
    <!-- Toastæç¤º -->
    <div class="toast-message" :class="{ show: showToast }">{{ toastMessage }}</div>

    <div class="container">
        <!-- é¡¶éƒ¨æç¤ºæ  -->
        <div class="alert">
            <span class="sos-icon">ğŸ†˜</span>
            å¡ç€ä¸åŠ¨ï¼Ÿä¸‹æ‹‰åˆ·æ–°
        </div>

        <!-- ä»»åŠ¡è¿›åº¦åŒºåŸŸ -->
        <div class="progress-section">
            <div class="progress-text">å®Œæˆä»¥ä¸‹å…¨éƒ¨ä»»åŠ¡è·å–</div>
            <div class="remaining-tasks">
                è¿˜æœ‰<span class="remaining-count">{{ remainingTasks }}</span>ä¸ªä»»åŠ¡éœ€å®Œæˆ
            </div>
        </div>

        <!-- ä»»åŠ¡åˆ—è¡¨æ ‡é¢˜ -->
        <div class="task-container" :class="{ hide: allTasksCompleted }">
            <div class="task-header">
                <div class="task-title">
                    <span class="icon">âŒ›</span>
                    ä»»åŠ¡åˆ—è¡¨
                </div>
                <div class="task-time">æ‰€æœ‰ä»»åŠ¡å®Œæˆåªéœ€45ç§’é’Ÿ</div>
            </div>

            <!-- ä»»åŠ¡åˆ—è¡¨ -->
            <div class="task-list">
                <!-- ä½¿ç”¨v-foræ¸²æŸ“ä»»åŠ¡åˆ—è¡¨ -->
                <div class="task-wrapper" v-for="(task, index) in tasks" :key="index">
                    <div class="task-item">
                        <div class="task-info">
                            <div class="lock-icon">ğŸ”’</div>
                            <div class="task-content">
                                <div class="task-name">
                                    {{ task.name }}
                                    <span class="status" :class="{ completed: task.completed }">
                                            {{ task.completed ? 'å·²å®Œæˆ' : 'æœªå®Œæˆ' }}
                                        </span>
                                </div>
                                <div class="task-desc">{{ task.desc }}</div>
                            </div>
                        </div>
                        <button class="unlock-btn" :class="{ completed: task.completed }"
                                @click="handleUnlock(index)">
                            {{ task.completed ? 'å·²å®Œæˆ' : 'å»è§£é”' }}
                        </button>
                    </div>
                    <div class="task-instruction" v-html="task.instruction"></div>
                </div>
            </div>

            <!-- åº•éƒ¨æ•™ç¨‹é“¾æ¥ -->
            <div class="footer">
                <a href="#">ä»»åŠ¡æµç¨‹ä¸æ¸…æ¥šï¼Ÿç‚¹è¿™é‡Œçœ‹æ•™ç¨‹</a>
            </div>
        </div>

        <!-- å®Œæˆæç¤º -->
        <div class="completion-message" :class="{ show: allTasksCompleted }">
            <!-- <div>æ­å–œå·²å®Œæˆæ‰€æœ‰ä»»åŠ¡</div> -->
            <div class="api-content" v-if="apiData.title || apiData.content">
                <div class="api-title" v-if="apiData.title">{{ apiData.title }}</div>
                <div class="api-text" v-if="apiData.content" v-html="apiData.content"></div>
                <button v-if="apiData.copy == 1" class="copy-button" @click="handleCopy"
                        style="display: block !important;">
                    ç‚¹å‡»å¤åˆ¶
                </button>
                <!-- æ·»åŠ è°ƒè¯•ä¿¡æ¯ -->
                <div style="display: none;">
                    Debug: copy={{ apiData.copy }},
                    copyContent={{ apiData.copyContent }}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    new Vue({
        el: '#app',
        data: {
            // ä¸‹æ‹‰åˆ·æ–°ç›¸å…³
            isRefreshVisible: false,
            refreshText: 'â†“ ä¸‹æ‹‰åˆ·æ–°',
            touchStartY: 0,
            minSwipeDistance: 100,

            // è®¡æ—¶ç›¸å…³
            startTime: 0,
            isHidden: false,
            duration: 0,

            // å½“å‰å¤„ç†çš„ä»»åŠ¡ç´¢å¼•
            currentTaskIndex: -1,

            // ä»»åŠ¡ç›¸å…³
            remainingTasks: 2,
            tasks: [
                {
                    name: 'å°ç¨‹åºè§£é”ä»»åŠ¡',
                    desc: 'è§£é”å®Œå¹¿å‘Šï¼Œå›æ¥å°±ç®—å®ŒæˆğŸ‘‰',
                    completed: false,
                    instruction: 'ç‚¹ã€<span class="highlight">å»è§£é”</span>ã€‘è·³å…¥å°ç¨‹åºï¼Œè§£é”çœ‹å®Œè§†é¢‘å¹¿å‘Šï¼Œç‚¹<span class="highlight">å¹¿å‘Šåº•éƒ¨ç»¿è‰²æŒ‰é’®ï¼Œåœ6ç§’</span>ï¼Œå†å…³å¹¿å‘Šï¼Œæœ€åç‚¹å³ä¸Šè§’å°åœ†åœˆè¿”å›'
                },
                {
                    name: 'å°ç¨‹åºè§£é”ä»»åŠ¡',
                    desc: 'è§£é”å®Œå¹¿å‘Šï¼Œå›æ¥å°±ç®—å®ŒæˆğŸ‘‰',
                    completed: false,
                    instruction: 'ç‚¹ã€<span class="highlight">å»è§£é”</span>ã€‘è·³å…¥å°ç¨‹åºï¼Œè§£é”çœ‹å®Œè§†é¢‘å¹¿å‘Šï¼Œç‚¹<span class="highlight">å¹¿å‘Šåº•éƒ¨ç»¿è‰²æŒ‰é’®ï¼Œåœ6ç§’</span>ï¼Œå†å…³å¹¿å‘Šï¼Œæœ€åç‚¹å³ä¸Šè§’å°åœ†åœˆè¿”å›'
                }
            ],
            uid: '',
            username1: '',
            projectName1: '',
            ip: '',
            // å¼¹çª—ç›¸å…³
            isPopupVisible: false,
            popupImage: '',
            popupText: '',
            showModal: false,  // æ§åˆ¶å¼¹çª—çš„æ˜¾ç¤º

            // æ·»åŠ APIè¿”å›æ•°æ®ç›¸å…³çš„å±æ€§
            apiData: {
                title: '',
                content: '',
                copy: 0,
                copyContent: ''
            },

            // Toastç›¸å…³
            showToast: false,
            toastMessage: '',

            // æ·»åŠ åŠ è½½åŠ¨ç”»ç›¸å…³çš„å±æ€§
            isLoading: false,
        },

        computed: {
            allTasksCompleted() {
                return this.tasks.every(task => task.completed);
            }
        },

        created() {
            // ç›‘å¬è§¦æ‘¸äº‹ä»¶
            document.addEventListener('touchstart', this.handleTouchStart);
            document.addEventListener('touchmove', this.handleTouchMove);
            document.addEventListener('touchend', this.handleTouchEnd);
            // è·å–ç”¨æˆ· IP
            // this.getVisitorIP();
            this.getIP()
        },


        mounted() {
            // ä» URL è·å– id å‚æ•°

                const urlParams = new URLSearchParams(window.location.search);
                this.uid = urlParams.get('id');
                this.detectEnvironment();

        },

        methods: {

            detectEnvironment() {
                const userAgent = navigator.userAgent.toLowerCase();

                // å…ˆåˆ¤æ–­æ˜¯å¦æ˜¯ç§»åŠ¨ç«¯ï¼ˆiOS/Androidï¼‰æˆ–æ˜¯ç”µè„‘ç«¯
                if (/iphone|ipod|ipad|android/i.test(userAgent)) {
                    // æ˜¯ç§»åŠ¨ç«¯è®¾å¤‡
                    this.detectMobile(userAgent);
                } else {
                    // æ˜¯ç”µè„‘è®¾å¤‡
                    this.detectPC(userAgent);
                }
            },

            detectMobile(userAgent) {
                if (/iphone|ipod|ipad/i.test(userAgent)) {
                    // iOSè®¾å¤‡
                    this.detectIOS(userAgent);
                } else {
                    // å…¶ä»–ç§»åŠ¨ç«¯è®¾å¤‡ï¼ˆä¾‹å¦‚Androidï¼‰
                    this.detectOtherMobile(userAgent);
                }
            },
            detectIOS(userAgent) {
                if (userAgent.includes('micromessenger')) {

                    alert('å½“å‰åœ¨iOSè®¾å¤‡ä¸Šçš„å¾®ä¿¡');
                } else if (userAgent.includes('qq')) {
                    alert('å½“å‰åœ¨iOSè®¾å¤‡ä¸Šçš„QQ');
                } else {
                    alert('å½“å‰åœ¨iOSè®¾å¤‡ä¸Šçš„æµè§ˆå™¨');
                }
            },
            detectOtherMobile(userAgent) {
                if (userAgent.includes('micromessenger')) {
                    alert('å½“å‰åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šçš„å¾®ä¿¡');
                } else if (userAgent.includes('qq')) {
                    alert('å½“å‰åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šçš„QQ');
                } else {
                    alert('å½“å‰åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šçš„æµè§ˆå™¨');
                }
            },
            detectPC(userAgent) {
                if (userAgent.includes('micromessenger')) {
                    alert('å½“å‰åœ¨ç”µè„‘ä¸Šçš„å¾®ä¿¡');
                } else if (userAgent.includes('qq')) {
                    alert('å½“å‰åœ¨ç”µè„‘QQ');
                } else {
                    alert('å½“å‰åœ¨ç”µè„‘æµè§ˆå™¨');
                }
            },
            // è·å–è®¿é—®è€… IP çš„æ–¹æ³•
            getVisitorIP() {
                fetch('https://api.ipify.org?format=json')
                    .then(response => response.json())
                    .then(data => {
                        this.ip = data.ip;
                        console.log('è®¿é—®è€…IP:', this.ip);
                    })
                    .catch(error => {
                        console.error('è·å–IPå¤±è´¥:', error);
                        // å¤‡ç”¨ IP è·å–æ–¹æ³•
                        this.getBackupIP();
                    });
            },

            // å¤‡ç”¨ IP è·å–æ–¹æ³•
            getBackupIP() {
                fetch('https://api.db-ip.com/v2/free/self')
                    .then(response => response.json())
                    .then(data => {
                        this.ip = data.ipAddress;
                        console.log('è®¿é—®è€…IP (å¤‡ç”¨æ–¹æ³•):', this.ip);
                    })
                    .catch(error => {
                        console.error('å¤‡ç”¨IPè·å–ä¹Ÿå¤±è´¥:', error);
                        this.ip = 'æœªçŸ¥IP';
                    });
            },

            getIP: function () {
                console.log('å¼€å§‹è·å–ï¼');
                fetch('https://api.coralset.com/public/getIp')  // è¯·æ›¿æ¢ä¸ºä½ è‡ªå·±åç«¯çš„åœ°å€
                    .then(response => response.text())  // è·å–åŸå§‹å“åº”æ–‡æœ¬
                    .then((data) => {  // ç›´æ¥ä½¿ç”¨è¿”å›çš„æ–‡æœ¬æ•°æ®
                        // æ£€æŸ¥ IP åœ°å€æ˜¯å¦æœ‰æ•ˆ
                        if (!data || data.trim() === '') {
                           this.getVisitorIP()
                        } else {
                            this.ip = data;  // å°†è·å–åˆ°çš„æœ‰æ•ˆ IP åœ°å€å­˜å‚¨åˆ° data ä¸­
                            console.log('User IP:', this.ip);  // æ‰“å° IP åœ°å€
                        }
                    })
                    .catch((error) => {
                        console.error('è·å–ç”¨æˆ· IP å¤±è´¥:', error);
                    });


            },

            // å¤„ç†é¡µé¢å¯è§æ€§å˜åŒ–
            handleVisibilityChange() {
                if (document.hidden) {
                    this.startTime = new Date().getTime();
                    this.isHidden = true;
                    this.showModal = false;
                    console.log('é¡µé¢éšè—ï¼Œå¼€å§‹è®¡æ—¶...');
                } else if (this.isHidden) {
                    const endTime = new Date().getTime();
                    this.duration = (endTime - this.startTime) / 1000;
                    console.log(`é¡µé¢é‡æ–°å¯è§ï¼Œéšè—æŒç»­æ—¶é—´ï¼š${this.duration}ç§’`);
                    this.isHidden = false;
                    // æ£€æŸ¥æ˜¯å¦æ»¡è¶³å®Œæˆæ¡ä»¶
                    if (this.duration >= 1) {
                        this.completeTask(this.currentTaskIndex);
                        console.log('ä»»åŠ¡å®Œæˆ');
                    }
                    // ç§»é™¤ç›‘å¬å™¨
                    document.removeEventListener('visibilitychange', this.handleVisibilityChange);
                }
            },

            // å¤„ç†è§£é”æŒ‰é’®ç‚¹å‡»
            handleUnlock(index) {
                console.log('ç›‘æµ‹åˆ°ç‚¹å‡»æŒ‰é’®äº‹ä»¶ï¼');
                // å­˜å‚¨å½“å‰ä»»åŠ¡ç´¢å¼•
                this.currentTaskIndex = index;
                // ç›‘å¬é¡µé¢å¯è§æ€§å˜åŒ–
                document.addEventListener('visibilitychange', this.handleVisibilityChange);
                this.popupText = 'è§£é”ä»»åŠ¡è¯´æ˜ï¼šè¯·å®Œæˆè§†é¢‘å¹¿å‘Šå¹¶æŒ‰æ­¥éª¤æ“ä½œã€‚'; // å¯ä»¥æ ¹æ®ä»»åŠ¡æ¥åŠ¨æ€è°ƒæ•´æ–‡å­—
                this.showModal = true;
            },
            // å…³é—­å¼¹çª—
            closeModal() {
                this.showModal = false;
            },
            // å®Œæˆä»»åŠ¡
            completeTask(index) {
                this.tasks[index].completed = true;
                this.remainingTasks = Math.max(0, this.remainingTasks - 1);

                // å¦‚æœæ‰€æœ‰ä»»åŠ¡å®Œæˆ
                if (this.allTasksCompleted) {
                    // æ˜¾ç¤ºå®Œæˆæç¤º
                    this.showToastMessage('ä»»åŠ¡å·²å…¨éƒ¨å®Œæˆ');

                    setTimeout(() => {
                        this.isLoading = true;
                        this.showToastMessage('åŠ è½½ä¸­...', 'loading');

                        setTimeout(() => {
                            this.isLoading = false;
                            this.showToast = false;
                            // æ»šåŠ¨åˆ°é¡¶éƒ¨
                            window.scrollTo({
                                top: 0,
                                behavior: 'smooth'
                            });
                            // è·å–æ•°æ®
                            this.getOneDate();

                        }, 500);
                    }, 700);
                }
            },
            record1() {
                // åœ¨ä¸¤ä¸ªä»»åŠ¡å®Œæˆåï¼Œè®°å½•å¹¶å°†å‚æ•°ä¼ é€’åˆ°åç«¯æœåŠ¡å™¨
                console.log('å¼€å§‹è®°å½•');
                fetch('https://api.coralset.com/public/addrecord', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        // appid: '',

                        username: this.username,
                        ip: this.ip || '',
                        projectName: 'H5',
                        // createTime: new Date().getTime() // å½“å‰æ—¶é—´æˆ³
                    })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.code === '200') {
                            console.log('è®°å½•æˆåŠŸ1:', data);
                        } else {
                            console.error('è®°å½•å¤±è´¥:', data.msg);
                            console.error('å‘é€çš„æ•°æ®:', {
                                // appid: '',

                                username: this.username,
                                ip: this.ip || '',
                                projectName: 'H5',
                                // createTime: new Date().getTime() // å½“å‰æ—¶é—´æˆ³
                            });
                        }
                    })
                    .catch(error => {
                        console.error('è®°å½•å¤±è´¥1:', error);
                    });
            },
            // è·å–æ•°æ®çš„æ–¹æ³•
            getOneDate() {
                console.log('å¼€å§‹è·å–æ•°æ®');

                fetch('https://api.coralset.com/public/selectByUnid?' + new URLSearchParams({
                    unid: this.uid
                }))
                    .then(response => {
                        if (!response.ok) {
                            // throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥');
                            console.log('ç½‘ç»œè¯·æ±‚å¤±è´¥');
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.code !== '200') {
                            console.log('ç½‘ç»œè¯·æ±‚å¤±è´¥')
                        }
                        console.log('è·å–çš„æ•°æ®æ˜¯ï¼š', data.data);
                        // æ›´æ–°APIæ•°æ®
                        // ç¡®ä¿copyå€¼ä¸ºæ•°å­—ç±»å‹
                        const apiData = {
                            ...data.data,
                            copy: parseInt(data.data.copy)
                        };
                        this.apiData = apiData;
                        console.log('copyå€¼æ˜¯ï¼š', this.apiData.copy);
                        console.log('copyContentæ˜¯ï¼š', this.apiData.copyContent);
                        console.log('copyçš„ç±»å‹æ˜¯ï¼š', typeof this.apiData.copy);
                        // ç¡®ä¿åœ¨è·å–åˆ°æ•°æ®åå†è®¾ç½®ç”¨æˆ·åå’Œæ‰§è¡Œè®°å½•
                        if (this.apiData.username) {
                            this.username = this.apiData.username;
                            // åœ¨ç¡®ä¿æœ‰ç”¨æˆ·åçš„æƒ…å†µä¸‹æ‰§è¡Œè®°å½•
                            this.record1();
                        } else {
                            console.error('æœªè·å–åˆ°ç”¨æˆ·åï¼Œè·³è¿‡è®°å½•');
                        }
                    })
                    .catch(error => {
                        console.error('è¯·æ±‚å¤±è´¥ï¼š', error);
                        // åœ¨æ•°æ®è·å–å¤±è´¥æ—¶ä¸æ‰§è¡Œè®°å½•
                        console.log('ç½‘ç»œè¯·æ±‚å¤±è´¥')
                    });
            },

            // ä¸‹æ‹‰åˆ·æ–°ç›¸å…³æ–¹æ³•
            handleTouchStart(e) {
                this.touchStartY = e.touches[0].clientY;
            },

            handleTouchMove(e) {
                // å¦‚æœä»»åŠ¡å·²å®Œæˆï¼Œç¦ç”¨ä¸‹æ‹‰åˆ·æ–°
                if (this.allTasksCompleted) {
                    return;
                }

                if (window.scrollY === 0) {
                    const currentY = e.touches[0].clientY;
                    const distance = currentY - this.touchStartY;

                    if (distance > 30) {
                        this.isRefreshVisible = true;
                        this.refreshText = distance > this.minSwipeDistance ?
                            'â†‘ é‡Šæ”¾åˆ·æ–°' : 'â†“ ä¸‹æ‹‰åˆ·æ–°';
                    } else {
                        this.isRefreshVisible = false;
                    }
                }
            },

            handleTouchEnd(e) {
                // å¦‚æœä»»åŠ¡å·²å®Œæˆï¼Œç¦ç”¨ä¸‹æ‹‰åˆ·æ–°
                if (this.allTasksCompleted) {
                    return;
                }

                const touchEndY = e.changedTouches[0].clientY;
                const swipeDistance = touchEndY - this.touchStartY;

                if (window.scrollY === 0 && swipeDistance > this.minSwipeDistance) {
                    this.refreshText = 'åˆ·æ–°ä¸­...';
                    location.reload();
                } else {
                    this.isRefreshVisible = false;
                }
            },

            // æ˜¾ç¤ºToastæç¤º
            showToastMessage(message, type = 'normal') {
                this.toastMessage = message;
                this.showToast = true;

                // è·å–Toastå…ƒç´ 
                const toastEl = document.querySelector('.toast-message');

                // æ ¹æ®ç±»å‹æ·»åŠ ä¸åŒçš„ç±»
                if (type === 'loading') {
                    toastEl.classList.add('loading');
                    // æ·»åŠ åŠ è½½åŠ¨ç”»
                    const loadingSpinner = document.createElement('div');
                    loadingSpinner.className = 'loading-spinner';
                    toastEl.appendChild(loadingSpinner);
                } else {
                    toastEl.classList.remove('loading');
                    // ç§»é™¤æ‰€æœ‰åŠ è½½åŠ¨ç”»å…ƒç´ 
                    const spinners = toastEl.querySelectorAll('.loading-spinner');
                    spinners.forEach(spinner => spinner.remove());
                }

                setTimeout(() => {
                    this.showToast = false;
                    // ç§»é™¤loadingç±»
                    toastEl.classList.remove('loading');
                }, 1500);
            },

            // ä¿®æ”¹å¤åˆ¶åŠŸèƒ½
            handleCopy() {
                try {
                    // åˆ›å»ºä¸´æ—¶æ–‡æœ¬åŒºåŸŸ
                    const textArea = document.createElement('textarea');
                    textArea.value = this.apiData.copyContent;
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-9999px';
                    textArea.style.top = '0';
                    document.body.appendChild(textArea);

                    // é€‰æ‹©æ–‡æœ¬
                    textArea.focus();
                    textArea.select();

                    // æ‰§è¡Œå¤åˆ¶å‘½ä»¤
                    const successful = document.execCommand('copy');

                    // ç§»é™¤ä¸´æ—¶å…ƒç´ 
                    document.body.removeChild(textArea);

                    // æ˜¾ç¤ºç»“æœ
                    if (successful) {
                        this.showToastMessage('å¤åˆ¶æˆåŠŸ');
                    } else {
                        this.showToastMessage('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
                    }
                } catch (err) {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    this.showToastMessage('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
                }
            }
        },

        destroyed() {
            // æ¸…ç†äº‹ä»¶ç›‘å¬
            document.removeEventListener('visibilitychange', this.handleVisibilityChange);
            document.removeEventListener('touchstart', this.handleTouchStart);
            document.removeEventListener('touchmove', this.handleTouchMove);
            document.removeEventListener('touchend', this.handleTouchEnd);
        }
    });
</script>
</body>

</html>